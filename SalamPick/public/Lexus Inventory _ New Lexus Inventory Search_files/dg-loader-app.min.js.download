var __defProp=Object.defineProperty,__defNormalProp=(e,t,a)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,__publicField=(e,t,a)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,a);!function(){"use strict";var e=(e=>(e.toyota="toyota",e.lexus="lexus",e))(e||{}),t=(e=>(e.local="local",e.dev="dev",e.test="test",e.stage="stage",e.demo="demo",e.prod="prod",e))(t||{}),a=(e=>(e.topNavSaveHeart="dg-save-heart",e.inlineSaveHeart="dg-inline-saves",e.shoppingCart="dg-shopping-cart",e.navMenu="dg-nav-menu",e.progressTracker="dg-progress-tracker",e.toastNotification="dg-toast-notification",e))(a||{}),o=(e=>(e.owners="/owners",e.dashboard="/owners/dashboard",e.profile="/profile",e.saves="/saves",e.tradeIns="/trade",e.deals="/my-deals",e))(o||{});var n,i,r,s;(i=n||(n={})).local="local",i.dev="dev",i.test="test",i.stage="stage",i.demo="demo",i.prod="prod",(s=r||(r={})).toyota="toyota",s.lexus="lexus";r.toyota,r.lexus,n.local,n.dev,n.test,n.stage,n.demo,n.prod;e.toyota,e.lexus,e.toyota,e.lexus;const d={t1ToyotaPattern:".toyota.com",t2ToyotaPattern:".buyatoyota.com",t2ToyotaSubprodPattern:".nonprod.jsds.tms.aws.toyota.com",t1LexusPattern:".lexus.com"};class ReadonlyDGDataHub{static get _windowDataHub(){return window.DGDataHub}static validatePageDataHub(){if(!this._windowDataHub||"object"!=typeof this._windowDataHub)throw new Error("window.DGDataHub must be defined as an object");if("string"!=typeof this._windowDataHub.DEPLOY_ENV)throw new Error("DGDataHub.DEPLOY_ENV must be defined as a string");const t=e.toyota;ReadonlyDGDataHub.brand!==t&&console.warn("DGDataHub.BRAND does not match dg-ui script version",{scriptBrand:t,DGDataHubBrand:ReadonlyDGDataHub.brand})}static isComponentIncludedOnPage(e){var t;return e===a.inlineSaveHeart||!!(null==(t=this._windowDataHub.components)?void 0:t[e])}static get brand(){return function asBrand(t){switch(null==t?void 0:t.toLowerCase()){case"toyota":return e.toyota;case"lexus":return e.lexus;default:return}}(this._windowDataHub.BRAND)||e.toyota}static get environment(){var e;const a=null==(e=this._windowDataHub)?void 0:e.DEPLOY_ENV.toLowerCase();return window.location.toString().includes(d.t2ToyotaSubprodPattern)?window.location.toString().includes("stg")?t.demo:t.stage:a||t.local}static get isMstc(){return!!this._windowDataHub.isMSTC}static get dealerCd(){return this._windowDataHub.dealerCd}static get zipCode(){return this._windowDataHub.zipCode}static get showContinuePurchaseText(){return this._windowDataHub.showContinuePurchaseText??!0}static get buildsRoute(){var e;return(null==(e=this._windowDataHub.pageRoutes)?void 0:e.buildRoute)||null}static get savesRoute(){var e;return(null==(e=this._windowDataHub.pageRoutes)?void 0:e.savesRoute)||o.saves}static get dealsRoute(){var e;return(null==(e=this._windowDataHub.pageRoutes)?void 0:e.dealsRoute)||o.deals}static get profileRoute(){return o.profile}static get dealerAgnosticFeatureConfig(){var e;return null==(e=this._windowDataHub.features)?void 0:e.dealerAgnostic}static get invertNavMenuIcons(){return!!this._windowDataHub.invertNavMenuIcons}static get isInIFrame(){return!!this._windowDataHub.iFrame}}function getDgUiScriptUrl(a){const o=ReadonlyDGDataHub.environment,n=ReadonlyDGDataHub.brand,i=n===e.lexus?"./dg-ui-entry.CEFlSAXL.min.js":"./dg-ui-entry.DtzRiL8L.min.js";if(o===t.local){const t=n===e.lexus?"8081":"8080";return[new URL(i,`http://localhost:${t}`)]}const r=function getCdnUrl(){const e=ReadonlyDGDataHub.environment;return"https://"+(e===t.prod?"cdn.dg.toyota.com":`cdn.${e}.dg.toyota.com`)}();return[new URL(`/deploy/dg-ui/${a}/${n}/${i}`,r),new URL(`/deploy/dg-ui/${a}/${n}/dg-ui-entry.min.js`,r)]}class BaseLogger{constructor(e,t,a,o){__publicField(this,"moduleName"),__publicField(this,"minLogLevel",0),__publicField(this,"context");const n=a?`::${a}`:"";this.moduleName=`${e}${n}`,this.context=o,t&&this.setEnv(t)}setEnv(e){this.minLogLevel="prod"===e?2:"demo"===e?1:0}debug(...e){this.minLogLevel<=0&&console.debug(`${this.moduleName}: `,...e,this.context)}info(...e){this.minLogLevel<=1&&console.info(`${this.moduleName}: `,...e,this.context)}log(...e){this.minLogLevel<=1&&console.log(`${this.moduleName}: `,...e,this.context)}warn(...e){this.minLogLevel<=2&&console.warn(`${this.moduleName}: `,...e,this.context)}error(...e){this.minLogLevel<=3&&console.error(`${this.moduleName}: `,...e,this.context)}}const l=new class Logger extends BaseLogger{constructor(e,t="dg-ui"){super(t,ReadonlyDGDataHub.environment,e,void 0)}}("script","dg-loader");function _loadScript(e){return new Promise(((t,a)=>{const o=window.document.createElement("script");o.onload=e=>t(e),o.onerror=e=>a(e),o.setAttribute("type","module"),o.setAttribute("src",e),window.document.body.appendChild(o)}))}var u=(e=>(e.dgUI="dg-ui",e))(u||{});const c="latest",loadAppScript=async(e,t)=>{const a=((e,t)=>({[u.dgUI]:getDgUiScriptUrl(t)}[e]||null))(e,t);null!==a?(l.debug("Loading script",{appName:e,version:t,url:a}),await async function loadScript(e){for(const a of e){const e=a.href;try{return l.debug("Loading script",e),void(await _loadScript(e))}catch(t){l.warn("Unable to load script",e,t)}}throw new Error("Unable to load scripts")}(a)):l.warn("Could not get script url",{appName:e,version:t})};async function loadScripts(){var e;const t=window.DGDataHub;(null==(e=t.__internal__)?void 0:e.hasStartedLoadingDGScripts)?l.debug("Has already started loading DG scripts, so skipping this time"):(t.__internal__.hasStartedLoadingDGScripts=!0,await function loadRequiredScripts(){const e={[u.dgUI]:c};return l.info("Loading DG scripts",e),Promise.all(Object.entries(e).map((([e,t])=>loadAppScript(e,t))))}(),t.__internal__.hasLoadedDGScripts=!0)}const _setupDgDataHub=()=>{const e=window.DGDataHub;e.__internal__||(e.__internal__={}),e.__internal__.loaderArtifactVersion="2.2.3-rc.5",e.getDgid=()=>{l.warn("Called getDgid before DG is fully loaded")},e.showDealerWarning=t=>{var a;t(),null==(a=e.continuePageLoad)||a.call(e)},e.changeActiveDealer=async t=>{e.dealerCd?e.dealerCd=t:l.warn("dealerCd is not defined on the DGDataHub. Should not be calling changeActiveDealer.")},e.getWarningState=()=>({dgLoaded:!1,modalShown:!1}),(()=>{const e=window.DGDataHub;e.renderInlineSaves=t=>{t&&(e.inlineSaveItems||(e.inlineSaveItems={}),Object.assign(e.inlineSaveItems,t))},e.deleteInlineSaveItem=t=>{var a,o;(null==(a=e.inlineSaveItems)?void 0:a[t])&&(null==(o=e.inlineSaveItems)||delete o[t])},e.deleteInlineSaveItems=t=>{t.forEach((t=>{var a;return t&&(null==(a=e.deleteInlineSaveItem)?void 0:a.call(e,t))}))}})();try{const t="__dg_override_env__",a=window.localStorage.getItem(t)||window.sessionStorage.getItem(t);a&&(e.DEPLOY_ENV=a,l.warn("Using override env",a))}catch(t){l.warn("Error setting override env",t)}},setupDgDataHub=(e=0)=>new Promise(((t,a)=>{if(window.DGDataHub){const e=window.DGDataHub;if(e.__internal__||(e.__internal__={}),e.__internal__.hasSetupDGDataHub)return void l.debug("Has already started DG loader, so skipping this time");l.debug("Setting up DGDataHub"),e.__internal__.hasSetupDGDataHub=!0,_setupDgDataHub(),t()}else e>10?a(new ReferenceError("We cannot detect any valid window.DGDataHub object globally declared on this page. It should be of type object.")):(l.debug("Waiting for DGDataHub",{tries:e}),setTimeout((()=>setupDgDataHub(e+1)),50))}));const g={INTEGRATION_NAME:"toyota-smartpath",DEALER_EVENT_NAME:"dealership-info-v1",PAGE_EVENT_NAME:"page-load-v1",SAVES_PAGE:{ALIAS:"SMARTPATH_DIGITAL_GARAGE_SAVES",DEFAULT_PATH:"/digital-garage/saves.htm",LOOKUP_KEY:"savesUrl"},DEALS_PAGE:{ALIAS:"SMARTPATH_DIGITAL_GARAGE_DEALS",DEFAULT_PATH:"/digital-garage/deals.htm",LOOKUP_KEY:"dealsUrl"},REDIRECT_PAGE:{ALIAS:"SMARTPATH_DIGITAL_GARAGE_REDIRECT",DEFAULT_PATH:"/digital-garage/redirect.htm",LOOKUP_KEY:"redirectUrl"},BUILD_PAGE:{ALIAS:"SMARTPATH_DIGITAL_GARAGE_BUILD",DEFAULT_PATH:"/digital-garage/build.htm",LOOKUP_KEY:"buildsUrl"}};Object.freeze(g);class DdcApi{constructor(){if(__publicField(this,"apiPromise"),!window.DDC)throw new Error("DDC not available on the window");this.apiPromise=window.DDC.APILoader.create(document.currentScript||g.INTEGRATION_NAME)}getEventInfo(e){return new Promise((t=>{this.apiPromise.then((a=>a.subscribe(e,(e=>t(e)))))}))}getConfig(){return this.apiPromise.then((e=>e.utils.getConfig()))}insertElementToContent(e){return new Promise((t=>{this.apiPromise.then((a=>{a.insert("content",(o=>{a.append(o,e),t()}))}))}))}}const getDeployEnvFromLoaderScriptUrl=()=>{const e=document.currentScript||document.querySelector("[src*=dg-loader-app]"),a=null==e?void 0:e.src;return(null==a?void 0:a.includes(".demo"))?t.demo:(null==a?void 0:a.includes(".stage"))||(null==a?void 0:a.includes("localhost"))?t.stage:(null==a?void 0:a.includes(".test"))?t.test:(null==a?void 0:a.includes(".dev"))?t.dev:t.prod},D="lexus-iframe-id",p="//lexus.com/build-your-lexus",getLexusBuildsIFrame=()=>{const e=[()=>document.getElementById(D),()=>document.getElementById("resizeIframe"),()=>document.querySelector(`iframe[src*="${p}"]`)];try{for(const t of e){const e=t();if(e&&"IFRAME"===e.tagName.toUpperCase())return e}}catch(t){l.error("Error getting lexus builds iframe",t)}return null};const setIFrameSrcWithDGData=e=>{const t=getLexusBuildsIFrame();if(!t)throw new Error("Could not find lexus builds iframe");const a=`https:${p}/#!/dealer/${ReadonlyDGDataHub.dealerCd}/zip/${ReadonlyDGDataHub.zipCode}/series/?parent=${window.location.origin}/&`;t.src=a+e};class DataHubBuilder{constructor(e){__publicField(this,"dataHub"),this.dataHub=e}build(){return this.dataHub}async setupBuildsPage(e,t){if(this.dataHub.setIFrameSrcWithDGData=setIFrameSrcWithDGData,this.dataHub.zipCode=t.payload.dealershipPostalCode,!getLexusBuildsIFrame()){const t=document.createElement("iframe");t.id=D,t.setAttribute("style","width: 100%; height: 6200px"),await e.insertElementToContent(t)}}setPageRoutesOnDataHub(e){"lexus"===this.dataHub.BRAND&&(this.dataHub.pageRoutes={},this.dataHub.pageRoutes.buildRoute=e[g.BUILD_PAGE.LOOKUP_KEY]||g.BUILD_PAGE.DEFAULT_PATH)}setDealerCodeOnDataHub(e){this.dataHub.dealerCd=e.payload.dealershipCodes.toyota_smartpath||e.payload.dealershipCodes.lexus}setBrandOnDataHub(e){this.dataHub.BRAND=e.payload.franchises[0]}setMenuIconColor(e,t){this.dataHub.invertNavMenuIcons=t.invertIconDesktop??!1,"mobile"===e.payload.layoutType&&(this.dataHub.invertNavMenuIcons=t.invertIconMobile??!1)}setOnboardingModal(e){this.dataHub.autoOpenOnboardingModal=!e.hideOnboardingModal}setShowContinuePurchaseText(e){this.dataHub.showContinuePurchaseText=e.showContinuePurchaseText}}const initializeDGDataHub=async()=>{window.DGDataHub=await(async()=>{const e=new DataHubBuilder({DEPLOY_ENV:getDeployEnvFromLoaderScriptUrl(),components:{[a.navMenu]:!0,[a.progressTracker]:!0,[a.inlineSaveHeart]:!1,[a.toastNotification]:!0,[a.shoppingCart]:!0,[a.topNavSaveHeart]:!0},appVersion:"latest",sidebarSettings:{display:!0}}),t=new DdcApi,o=await t.getEventInfo(g.DEALER_EVENT_NAME),n=await t.getEventInfo(g.PAGE_EVENT_NAME),i=await t.getConfig();return e.setBrandOnDataHub(n),e.setPageRoutesOnDataHub(i),e.setDealerCodeOnDataHub(o),e.setMenuIconColor(n,i),e.setOnboardingModal(i),e.setShowContinuePurchaseText(i),n.payload.pageName!==g.BUILD_PAGE.ALIAS&&"BUILD_YOUR_LEXUS"!==n.payload.pageName||await e.setupBuildsPage(t,o),e.build()})()};!async function(){if(window.DDC)try{await initializeDGDataHub()}catch(e){console.error("there was an error initializing dataHub with DDC API",e)}try{await async function loadDg(){await setupDgDataHub(),await loadScripts()}(),l.debug("DG loader finished successfully")}catch(e){l.error("DG loader error",e)}}()}();
//# sourceMappingURL=dg-loader-app.min.js.map

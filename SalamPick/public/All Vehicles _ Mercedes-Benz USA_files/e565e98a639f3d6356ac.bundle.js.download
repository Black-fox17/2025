"use strict";(self.webpackChunk_mbusa_now_aem=self.webpackChunk_mbusa_now_aem||[]).push([[816],{70816:function(e,t,r){r.d(t,{g:function(){return A},s:function(){return M}});var a=r(42982),n=r(15671),i=r(43144),o=r(4942),s=r(8357);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var E=null,u="MB_USER_PROFILE",O={preferredDealer:null,lastLocation:{}},T=function(){function e(){if((0,n.Z)(this,e),E)return E;E=this,this.data=null,this.create()}return(0,i.Z)(e,[{key:"create",value:function(){var e=new Date;this.data=s.tO.localStorage.read(u),this.data||(this.data=O,s.tO.localStorage.create(u,this.data,new Date(e.setDate(e.getDate()+60))))}},{key:"normalizePreferredDealer",value:function(e){return["contact","isDealership","marketCode","regionCode"].map(Object.hasOwnProperty.bind(e)).some((function(e){return!e}))?(this.setPreferredDealer(null),null):e}},{key:"setPreferredDealer",value:function(e){this.data=c({},this.data,{preferredDealer:e}),s.tO.localStorage.update(u,this.data)}},{key:"getPreferredDealer",value:function(){return this.data.preferredDealer?this.normalizePreferredDealer(this.data.preferredDealer):this.data.preferredDealer}},{key:"setLastLocation",value:function(e){this.data=c({},this.data,{lastLocation:e}),s.tO.localStorage.update(u,this.data)}},{key:"getLastLocation",value:function(){return this.data.lastLocation||O.lastLocation}},{key:"get",value:function(){return this.data}}]),e}(),f=r(24282),A={TYPE:{LOCAL_STORAGE:"local storage"},STORAGE:{LAST_SEARCHED_LOCATION_LOCALSTORAGE:"LAST_SEARCHED_LOCATION",LAST_SELECTED_DEALER_LOCALSTORAGE:"LAST_SELECTED_DEALER",LAST_LOCATION_PROFILE_LS:"lastLocation",PREFERRED_DEALER_LOCALSTORAGE:"PREFERRED_DEALER",USER_PROFILE_LOCALSTORAGE:"MB_USER_PROFILE"},TARGET_OFFER_DATA:{DEALER_ID:"dealer_id",GEO_LOCATION_ZIP:"profile.geolocation.zip",TARGET:"target",USER_ATTRIBUTE:"user.crs_attribute_1",USER_ATTRIBUTE_QA:"user.crs_attribute_1_qa"},PRIORITIZED_DATA_TYPES:{LAST_SEARCHED_LOCATION:"lastSearchedLocation",LAST_SELECTED_DEALER:"lastSelectedDealer",PREFERRED_DEALER:"preferredDealer",TARGET_DEALER_ID:"targetDealer",TARGET_GEO_ZIP:"geolocalization"}};function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var S=Symbol("legacyUserProfile"),d=Symbol("dataObj"),_=Symbol("config"),D=Symbol("createDataObj"),p=Symbol("targetData"),y=Symbol("personalizationApiInstance"),L=Symbol("setPriorityList"),P=Symbol("getPreferredDealer"),g=Symbol("setPreferredDealer"),b=Symbol("getLastSearchedLocation"),v=Symbol("setLastSearchedLocation"),I=Symbol("getLastSelectedDealer"),C=Symbol("setLastSelectedDealer"),m=Symbol("getLegacyProperty"),w=Symbol("setLegacyProperty"),N=Symbol("removeDataItem"),k=Symbol("getUserPreferenceData"),Z=Symbol("setUpDealerLocationPrioritization"),G=Symbol("getTargetDealerId"),j=Symbol("getTargetGeolocationZip"),F=null,U=Symbol("singletonEnforcer"),z={data:null,receievedFrom:"",type:""},B={},M=function(){function e(t){if((0,n.Z)(this,e),t!==U)throw new Error("Singleton; do not instantiate");return this[S]=new T,this[d]=this[D](),this[_]=window.mbNafta.ns("applicationProperties").dealerLocationPrioritizationConfig||B,this[p]={},this[y]=null,s.Gu.isEmpty(this[_])&&console.info("Dealers & Locations Prioritization JSON not found"),this[Z]()}return(0,i.Z)(e,null,[{key:"getInstance",value:function(){return F||(F=new e(U)),F}}]),(0,i.Z)(e,[{key:D,value:function(){return Object.keys(A.PRIORITIZED_DATA_TYPES).reduce((function(e,t){return h({},e,(0,o.Z)({},A.PRIORITIZED_DATA_TYPES[t],null))}),{})}},{key:Z,value:function(){var e=this;return new Promise((function(t){try{e[y]=f.Z.getInstance(f.Z.CONSTANTS.MCP),e[y].loadPersonalization((function(){e[k](),t(e)}))}catch(r){console.warn("Personalization API no instantiated: ",r),e[y]=null,t(e)}}))}},{key:L,value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";return this[_]&&this[_][e]&&this[_][e][t]||[]}},{key:P,value:function(){var e=A.PRIORITIZED_DATA_TYPES.PREFERRED_DEALER,t=A.STORAGE.PREFERRED_DEALER_LOCALSTORAGE,r=s.tO.localStorage.read(t)||null,a=this[m](e),n=null;return r?n={type:"dealer",data:r,receievedFrom:e}:a&&(this[g](a),n={type:"dealer",data:a,receievedFrom:e}),this[d][e]=n,n}},{key:g,value:function(e,t){var r=A.PRIORITIZED_DATA_TYPES.PREFERRED_DEALER,a=A.STORAGE.PREFERRED_DEALER_LOCALSTORAGE,n=s.tO.localStorage.read(a)||null;return t&&this[w](r,e),n?s.tO.localStorage.update(a,e):s.tO.localStorage.create(a,e),this[d][r]={type:"dealer",data:e,receievedFrom:r},this[d][r]}},{key:b,value:function(){var e=A.PRIORITIZED_DATA_TYPES.LAST_SEARCHED_LOCATION,t=A.STORAGE,r=t.LAST_SEARCHED_LOCATION_LOCALSTORAGE,a=t.LAST_LOCATION_PROFILE_LS,n=s.tO.localStorage.read(r)||null,i=this[m](a),o=null;return n&&n.searchLocation?o={type:n.searchByType,data:n.searchLocation,receievedFrom:e}:i&&i.searchLocation&&(this[v](i.searchLocation,i.searchByType),o={type:i.searchByType,data:i.searchLocation,receievedFrom:e}),this[d][e]=o,o}},{key:v,value:function(e,t,r){var a=A.PRIORITIZED_DATA_TYPES.LAST_SEARCHED_LOCATION,n=A.STORAGE.LAST_SEARCHED_LOCATION_LOCALSTORAGE,i=s.tO.localStorage.read(n)||null,o=new Date,l=new Date(o.setDate(o.getDate()+7)),c={searchLocation:e,searchByType:t};return r&&this[w](a,c),i?s.tO.localStorage.update(n,c):s.tO.localStorage.create(n,c,l),this[d][a]={type:t,data:e,receievedFrom:a},this[d][a]}},{key:I,value:function(){var e=A.PRIORITIZED_DATA_TYPES.LAST_SELECTED_DEALER,t=A.STORAGE.LAST_SELECTED_DEALER_LOCALSTORAGE,r=s.tO.localStorage.read(t)||null;if(r&&r.dealerId){var a={type:"dealer",data:r,receievedFrom:e};return this[d][e]=a,a}return null}},{key:C,value:function(e){var t=A.STORAGE.LAST_SELECTED_DEALER_LOCALSTORAGE,r=A.PRIORITIZED_DATA_TYPES.LAST_SELECTED_DEALER,a=s.tO.localStorage.read(t)||null,n=new Date,i=new Date(n.setDate(n.getDate()+7));return a?s.tO.localStorage.update(t,e):s.tO.localStorage.create(t,e,i),this[d][r]={type:"dealer",data:e,receievedFrom:r},this[d][r]}},{key:N,value:function(e,t){var r=A.STORAGE,a=A.PRIORITIZED_DATA_TYPES;switch(t&&this[w](e,null),e){case a.LAST_SELECTED_DEALER:s.tO.localStorage.delete(r.LAST_SELECTED_DEALER_LOCALSTORAGE);break;case a.LAST_SEARCHED_LOCATION:s.tO.localStorage.delete(r.LAST_SEARCHED_LOCATION_LOCALSTORAGE);break;case a.PREFERRED_DEALER:s.tO.localStorage.delete(r.PREFERRED_DEALER_LOCALSTORAGE)}}},{key:m,value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A.STORAGE.USER_PROFILE_LOCALSTORAGE;return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.TYPE.LOCAL_STORAGE)===A.TYPE.LOCAL_STORAGE&&(t=s.tO.localStorage.read(r)||null)&&t[e]?t[e]:null}},{key:w,value:function(e,t){var r=A.PRIORITIZED_DATA_TYPES;switch(e){case r.LAST_SEARCHED_LOCATION:this[S].setLastLocation(t);break;case r.PREFERRED_DEALER:this[S].setPreferredDealer(t)}}},{key:k,value:function(){if(!this[y]&&!("extractDataByProperty"in this[y]))return{};if(Object.keys(this[p]).length)return this[p];var e=A.TARGET_OFFER_DATA,t=e.GEO_LOCATION_ZIP,r=e.USER_ATTRIBUTE,a=e.USER_ATTRIBUTE_QA,n=this[y].extractDataByProperty(r),i=this[y].extractDataByProperty(a),o=this[y].extractDataByProperty(t);return 0!==Object.entries(n).length&&(this[p]=h({},n)),0!==Object.entries(i).length&&(this[p][r]=i[a]),0!==Object.entries(o).length&&(this[p]=h({},this[p],{},o)),this[p]}},{key:G,value:function(){var e=A.TARGET_OFFER_DATA,t=e.USER_ATTRIBUTE,r=e.DEALER_ID,a=A.PRIORITIZED_DATA_TYPES.TARGET_DEALER_ID,n=this[p]&&this[p][t];if(n){var i=(0,s.Hx)(n)[r]||null;if(i){var o={data:i,receievedFrom:a,type:"dealerId"};return this[d][a]=o,o}}return null}},{key:j,value:function(){var e=A.TARGET_OFFER_DATA.GEO_LOCATION_ZIP,t=A.PRIORITIZED_DATA_TYPES.TARGET_GEO_ZIP,r=this[p]&&this[p][e];if(r){var a={data:r,receievedFrom:t,type:"zip"};return this[d][t]=a,a}return null}},{key:"get",value:function(e){var t,r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",n=A.PRIORITIZED_DATA_TYPES;return this[L](e,a).find((function(e){switch(e){case n.PREFERRED_DEALER:t=r[P]();break;case n.LAST_SEARCHED_LOCATION:t=r[b]();break;case n.LAST_SELECTED_DEALER:t=r[I]();break;case n.TARGET_DEALER_ID:t=r[G]();break;case n.TARGET_GEO_ZIP:t=r[j]()}return t})),t||z}},{key:"set",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(t)||(t=[t]),null!==t[0]){var n=A.PRIORITIZED_DATA_TYPES;switch(e){case n.PREFERRED_DEALER:this[g].apply(this,(0,a.Z)(t).concat([r]));break;case n.LAST_SELECTED_DEALER:this[C].apply(this,(0,a.Z)(t));break;case n.LAST_SEARCHED_LOCATION:this[v].apply(this,(0,a.Z)(t).concat([r]))}}else this[N](e,r)}}]),e}();(0,o.Z)(M,"DATA_TYPES",A.PRIORITIZED_DATA_TYPES)},24282:function(e,t,r){r.d(t,{Z:function(){return A}});var a=r(15671),n=r(43144),i=r(4942),o=r(71002),s=r(8357),l=function(){function e(t){if((0,a.Z)(this,e),!t)throw new Error(e.CONSTANTS.ERROR_UNDEFINED);if(t!==window.adobe.target)throw new Error(e.CONSTANTS.ERROR_NOT_EQUAL);this.api=t,this.mbox=void 0,this.getCampaignOffer=this.getCampaignOfferFactory();var r=null;this.getOffers=function(){return r},this.setOffers=function(e){r=e}}return(0,n.Z)(e,[{key:"checkMBox",value:function(){return this.mbox=window.mbNafta.ns("personalization","target").mbox,!!this.mbox}},{key:"extractDataByProperty",value:function(t,r){if(!this.getOffers()||!e.CONSTANTS.ACTION||!t)return{};var a={},n=this.getOffers().filter((function(t){return t.action===e.CONSTANTS.ACTION}));return n.length?(n.forEach((function(e){e.content&&e.content.length&&e.content.forEach((function(e){return e[t]&&(r||(a[t]&&"object"===(0,o.Z)(a[t])?a[t]=[a[t],e[t]].flat():a[t]=e[t]),e[t]===r&&(a[r]&&"object"===(0,o.Z)(a[r])?a[r]=[a[r],e].flat():a[r]=e)),null}))})),a):{}}},{key:"getCampaignOfferFactory",value:function(){return window.adobe&&window.adobe.target&&window.adobe.target.getOffer?window.adobe.target.getOffer:function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{error:s.ZT}).error(501,"Adobe Target Library Not Available")}}},{key:"loadPersonalization",value:function(e){var t=this,r=this.checkMBox.bind(this);return(0,s.MV)(r,2e3,150).then((function(){t.getCampaignOffer({mbox:t.mbox,success:function(r){t.setOffers(r||{}),e(r)},error:function(t,r){console.warn("TargetApi.loadPersonalization:getCampaignOffer",t,r),e()}})})).catch((function(t){console.warn("TargetApi.loadPersonalization:checkReadyState",t),e()}))}}]),e}();(0,i.Z)(l,"CONSTANTS",{ACTION:"setJson",ERROR_NOT_EQUAL:"TargetApi: This api requires the target provider.",ERROR_UNDEFINED:"TargetApi: Must pass personalization api to constructor."});var c=function(){function e(){var t,r;(0,a.Z)(this,e),this.apiURL=null===(t=window.mbNafta)||void 0===t||null===(r=t.applicationProperties)||void 0===r?void 0:r.salesForceMcpEndpoint;var n=null;this.getOffers=function(){return n},this.setOffers=function(e){n=e}}return(0,n.Z)(e,[{key:"extractDataByProperty",value:function(e,t){if(!this.getOffers()||!e)return{};var r={},a=this.getOffers();return a.length?(a.forEach((function(a){a.payload&&a.payload[e]&&(t||(r[e]&&"object"===(0,o.Z)(r[e])?r[e]=[r[e],a.payload[e]].flat():r[e]=a.payload[e]),a.payload[e]===t&&(r[t]&&"object"===(0,o.Z)(r[t])?r[t]=[r[t],a.payload].flat():r[t]=a.payload,r[t]["activity.name"]=a.campaignName))})),r):{}}},{key:"loadPersonalization",value:function(e){var t=this;if(!this.apiURL)return e(),null;var r={action:"Payload",user:{id:s.pR.getCookie("MBUSA_WEB_ID")}},a=new Headers;return a.set("Content-Type","application/json"),fetch(this.apiURL,{method:"POST",headers:a,body:JSON.stringify(r)}).then((function(e){return e.json()})).then((function(r){var a=null==r?void 0:r.campaignResponses;a?(t.setOffers(a||[]),e(a)):e()})).catch((function(t){console.warn("MCPApi.loadPersonalization:checkReadyState",t),e()}))}}]),e}();function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}(0,i.Z)(c,"CONSTANTS",{ERROR_NOT_EQUAL:"MCPApi: This api requires the target provider.",ERROR_UNDEFINED:"MCPApi: Must pass personalization api to constructor."});var O=Symbol("singletonEnforcer"),T={},f=function(){function e(t,r){if((0,a.Z)(this,e),r!==O)throw new Error("Singleton; do not instantiate");switch(t){case e.CONSTANTS.TARGET:if(window.adobe=window.adobe||{},void 0===window.adobe.target)throw new Error(e.CONSTANTS.ERROR_TARGET_UNDEFINED);this.api=new l(window.adobe.target);break;case e.CONSTANTS.MCP:this.api=new c;break;default:console.error(e.CONSTANTS.ERROR_NO_PROVIDER,t)}return this.callbackList=[],this}return(0,n.Z)(e,null,[{key:"getInstance",value:function(t){return T[t]&&t||(T[t]=new e(t,O)),T[t]}}]),(0,n.Z)(e,[{key:"extractDataByProperty",value:function(e,t){return this.api&&this.api.extractDataByProperty&&this.api.extractDataByProperty(e,t)}},{key:"getTargetModifiers",value:function(t){if(!this.extractDataByProperty)return{};var r={},a=this.extractDataByProperty(e.CONSTANTS.COMPONENT,t);return Object.keys(a).forEach((function(e){a[e].length?a[e].forEach((function(e){e.modifiers&&e.modifiers.length&&(r=u({},r,{},e.modifiers[0]))})):a[e].modifiers&&a[e].modifiers.length&&(r=u({},r,{},a[e].modifiers[0]))})),(0,i.Z)({},t,r)}},{key:"getOffers",value:function(){return this.api&&this.api.getOffers&&this.api.getOffers()}},{key:"loadPersonalization",value:function(e){return this.api&&this.api.loadPersonalization&&!this.getOffers()?(this.loadingResults||(this.loadingResults=this.api.loadPersonalization(this.callCallbackMethods.bind(this))),this.callbackList.push(e),this.loadingResult):e()}},{key:"callCallbackMethods",value:function(){this.callbackList.forEach((function(e){return e()}))}},{key:"setOffers",value:function(e){return this.api&&this.api.setOffers&&this.api.setOffers(e)}}]),e}();(0,i.Z)(f,"CONSTANTS",{COMPONENT:"component",TARGET:"target",MCP:"MCP",ERROR_NO_PROVIDER:"PersonalizationApi: No personalization provider set: type:",ERROR_TARGET_UNDEFINED:"PersonalizationApi Error: target not defined. Will not instantiate TargetApi.",ERROR_MCP_UNDEFINED:"PersonalizationApi Error: MCP not defined. Will not instantiate MCPApi."});var A=f}}]);
//# sourceMappingURL=e565e98a639f3d6356ac.bundle.js.map